% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/output.R
\name{prepare_data_density}
\alias{prepare_data_density}
\title{Format MCMC Samples for Visualization}
\usage{
prepare_data_density(stan_results)
}
\arguments{
\item{stan_results}{A list containing all MCMC results and metadata, expected to include:
\describe{
  \item{samples}{An object of class `mcmc.list` (posterior samples for species- and complex-level parameters).}
  \item{chain_length}{Integer. Total number of MCMC iterations per chain.}
  \item{burnin}{Integer. Number of initial iterations to discard.}
  \item{thinning}{Integer. Thinning interval used during sampling.}
  \item{species_complex}{A `data.frame` mapping species and complexes with columns `species`, `complex`, `speciesNb`, `complexNb`.}
}}
}
\value{
A `data.frame` in long format with the following columns:
\describe{
  \item{`value`}{Posterior sample value.}
  \item{`Nb`}{Index number of the parameter (species or complex ID).}
  \item{`level`}{Level of the parameter: `"species"`, `"complex"`, or `"genus"`.}
  \item{`name`}{Name of the species, complex, or `"GENUS"` (for group-level effect).}
  \item{`higher_level`}{Grouping label: complex name for species, self-name for complex/genus.}
}
}
\description{
Converts MCMC samples from a hierarchical Bayesian model into a tidy (long-format) `data.frame` enriched with taxonomic information.
The function identifies the level (species, complex, or genus), assigns names based on taxonomy, and maps groupings for later plotting.
}
\details{
Species-level parameters are assumed to be named `p2[...]` and complex-level parameters `p1[...]`.
A special case is handled when `p1[1]` represents the genus-level intercept. The function processes indices and variable names using regular expressions, and joins taxonomic metadata using `species_complex`.
}
